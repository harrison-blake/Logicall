<div class="flex-1 px-6 py-8">
    <div class="max-w-7xl mx-auto space-y-6">

      <div class="flex flex-col lg:flex-row gap-6 lg:items-end">
        <section class="flex flex-row flex-wrap gap-2">
          <%= link_to new_intake_path, class: "text-sm bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded text-center" do %>
            New intake
          <% end %>
          <% if current_user.owner? || current_user.admin? %>
            <%= link_to new_account_staff_path(current_user.account), class: "text-sm border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 py-2 px-4 rounded text-center" do %>
              Add staff
            <% end %>
          <% end %>
        </section>

        <section class="flex-1">
          <h2 class="text-sm text-gray-500 dark:text-gray-400 mb-3">Overview</h2>
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
            <%= link_to intakes_path(status: :pending), class: "block p-3 border border-gray-200 dark:border-gray-700 rounded hover:border-gray-300 dark:hover:border-gray-600" do %>
              <div class="text-xl font-semibold"><%= @pending_intakes_count %></div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Pending intakes</div>
            <% end %>
            <%= link_to tasks_path(status: :pending), class: "block p-3 border border-gray-200 dark:border-gray-700 rounded hover:border-gray-300 dark:hover:border-gray-600" do %>
              <div class="text-xl font-semibold"><%= @pending_tasks_count %></div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Pending tasks</div>
            <% end %>
            <%= link_to intakes_path(status: :reviewed), class: "block p-3 border border-gray-200 dark:border-gray-700 rounded hover:border-gray-300 dark:hover:border-gray-600" do %>
              <div class="text-xl font-semibold"><%= @reviewed_intakes_count %></div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Reviewed</div>
            <% end %>
            <%= link_to call_transcripts_path, class: "block p-3 border border-gray-200 dark:border-gray-700 rounded hover:border-gray-300 dark:hover:border-gray-600" do %>
              <div class="text-xl font-semibold"><%= @call_transcripts_count %></div>
              <div class="text-xs text-gray-500 dark:text-gray-400">Calls</div>
            <% end %>
          </div>
        </section>
      </div>

      <div class="flex flex-col lg:flex-row gap-6">
        <section class="lg:w-96">
          <h2 class="text-sm text-gray-500 dark:text-gray-400 mb-3">Agent activity</h2>
          <div class="border border-gray-200 dark:border-gray-700 rounded p-3 bg-gray-50 dark:bg-gray-800">
            <div id="action-log" class="h-80 overflow-y-auto text-xs text-gray-600 dark:text-gray-400 space-y-2">
              <% if @recent_calls.any? || @recent_logs.any? %>
                <% @recent_calls.each do |call| %>
                  <div>
                    <span class="text-gray-400 dark:text-gray-500"><%= call.created_at.strftime("%b %d %H:%M") %></span>
                    <p>Call from <%= call.caller_phone %> (<%= call.call_duration %>s)</p>
                  </div>
                <% end %>
                <% @recent_logs.each do |log| %>
                  <div>
                    <span class="text-gray-400 dark:text-gray-500"><%= log.created_at.strftime("%b %d %H:%M") %></span>
                    <p><%= log.details %></p>
                  </div>
                <% end %>
              <% else %>
                <p class="text-gray-400 dark:text-gray-500">Activity will appear here.</p>
              <% end %>
            </div>
          </div>
        </section>

        <section class="flex-1" data-controller="chat">
          <h2 class="text-sm text-gray-500 dark:text-gray-400 mb-3">Assistant</h2>
          <div class="border border-gray-200 dark:border-gray-700 rounded p-4">
            <div id="chat-messages" data-chat-target="messages" class="space-y-3 mb-4 h-80 overflow-y-auto text-sm">
              <p class="text-gray-400 dark:text-gray-500">Ask about intakes, tasks, or anything else.</p>
            </div>
            <%= form_with url: dashboard_chat_path, method: :post, class: "flex gap-2", data: { action: "submit->chat#submit" } do |f| %>
              <%= f.text_field :prompt,
                  placeholder: "e.g. Create tasks for John Smith",
                  class: "flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white dark:bg-gray-800",
                  autocomplete: "off",
                  data: { chat_target: "input" } %>
              <%= f.submit "Send", class: "bg-blue-600 hover:bg-blue-700 text-white text-sm py-2 px-4 rounded cursor-pointer" %>
            <% end %>
          </div>
        </section>
      </div>

    </div>
</div>
