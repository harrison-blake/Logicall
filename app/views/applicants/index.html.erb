<div class="flex-1 px-6 py-8">
  <div class="max-w-full mx-auto">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Hiring Pipeline</h1>
      <%= link_to "New Applicant", new_applicant_path, class: "bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded-md transition-colors" %>
    </div>

    <div class="flex gap-4 overflow-x-auto pb-4" data-controller="kanban">
      <% status_colors = {
        "applied" => "blue",
        "screening" => "yellow",
        "interview" => "purple",
        "offer" => "emerald",
        "hired" => "green",
        "rejected" => "red"
      } %>

      <% @statuses.each do |status| %>
        <% color = status_colors[status] %>
        <% applicants_in_status = @applicants.select { |a| a.status == status } %>

        <div class="flex-shrink-0 w-72 bg-gray-50 dark:bg-gray-800 rounded-lg"
             data-action="dragover->kanban#dragover dragleave->kanban#dragleave drop->kanban#drop"
             data-status="<%= status %>">

          <div class="px-3 py-2 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-<%= color %>-500"></span>
              <h2 class="text-sm font-medium text-gray-700 dark:text-gray-300"><%= status.humanize %></h2>
            </div>
            <span class="text-xs text-gray-400 dark:text-gray-500"><%= applicants_in_status.size %></span>
          </div>

          <div class="p-2 space-y-2 min-h-[200px]" data-kanban-target="cardList">
            <% applicants_in_status.each do |applicant| %>
              <div class="bg-white dark:bg-gray-700 rounded-md shadow-sm p-3 cursor-grab active:cursor-grabbing border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow"
                   draggable="true"
                   data-applicant-id="<%= applicant.id %>"
                   data-action="dragstart->kanban#dragstart dragend->kanban#dragend">
                <%= link_to edit_applicant_path(applicant), class: "block" do %>
                  <p class="text-sm font-medium text-gray-900 dark:text-gray-100"><%= applicant.user.name %></p>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-1"><%= applicant.position %></p>
                  <% total = applicant.onboarding_steps.size %>
                  <% if total > 0 %>
                    <% done = applicant.onboarding_steps.count { |s| s.completed? } %>
                    <div class="mt-2 flex items-center gap-2">
                      <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-1">
                        <div class="bg-blue-500 h-1 rounded-full" style="width: <%= (done.to_f / total * 100).round %>%"></div>
                      </div>
                      <span class="text-xs text-gray-400"><%= done %>/<%= total %></span>
                    </div>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
