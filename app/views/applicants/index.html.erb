<div class="px-6 py-8">
  <div class="max-w-full mx-auto">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-xl font-semibold tracking-tight text-stone-900 dark:text-stone-100">Hiring Pipeline</h1>
      <%= link_to "New applicant", new_applicant_path, class: "text-sm bg-violet-600 hover:bg-violet-700 text-white font-medium py-2 px-4 rounded-lg transition-colors" %>
    </div>

    <div class="flex gap-4 overflow-x-auto pb-4" data-controller="kanban">
      <% status_colors = {
        "applied" => "violet",
        "screening" => "amber",
        "interview" => "sky",
        "offer" => "emerald",
        "hired" => "green",
        "rejected" => "rose"
      } %>

      <% @statuses.each do |status| %>
        <% color = status_colors[status] %>
        <% applicants_in_status = @applicants.select { |a| a.status == status } %>

        <div class="flex-shrink-0 w-72 bg-white dark:bg-stone-900 rounded-xl shadow-sm"
             data-kanban-target="column"
             data-status="<%= status %>">

          <div class="px-4 py-3 border-b border-stone-100 dark:border-stone-800 flex items-center justify-between">
            <div class="flex items-center gap-2.5">
              <span class="w-2 h-2 rounded-full bg-<%= color %>-500"></span>
              <h2 class="text-sm font-medium text-stone-700 dark:text-stone-300"><%= status.humanize %></h2>
            </div>
            <span class="text-xs text-stone-400 dark:text-stone-500 tabular-nums" data-count><%= applicants_in_status.size %></span>
          </div>

          <div class="p-2.5 space-y-2 min-h-[200px]" data-kanban-target="cardList">
            <% applicants_in_status.each do |applicant| %>
              <div class="bg-stone-50 dark:bg-stone-800 rounded-lg p-3.5 cursor-grab active:cursor-grabbing hover:bg-stone-100 dark:hover:bg-stone-700/50 transition-colors"
                   data-applicant-id="<%= applicant.id %>">
                <%= link_to edit_applicant_path(applicant), class: "block" do %>
                  <p class="text-sm font-medium text-stone-900 dark:text-stone-100"><%= applicant.user.name %></p>
                  <p class="text-xs text-stone-400 dark:text-stone-500 mt-1"><%= applicant.position %></p>
                  <% total = applicant.onboarding_steps.size %>
                  <% if total > 0 %>
                    <% done = applicant.onboarding_steps.count { |s| s.completed? } %>
                    <div class="mt-2.5 flex items-center gap-2">
                      <div class="flex-1 bg-stone-200 dark:bg-stone-600 rounded-full h-1">
                        <div class="bg-violet-500 h-1 rounded-full transition-all" style="width: <%= (done.to_f / total * 100).round %>%"></div>
                      </div>
                      <span class="text-[10px] text-stone-400 tabular-nums"><%= done %>/<%= total %></span>
                    </div>
                  <% end %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
